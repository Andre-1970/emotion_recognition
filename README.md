# Система по распознаванию эмоций

## Описание задачи (легенда)

Привет! Мы — компания самыезрелищныесериалы.рф, и в нашем сервисе много сериалов. Чтобы завоевать интерес зрителей, мы показываем им трейлеры — небольшие видеоролики, состоящие из наиболее зрелищных моментов сериалов.

Мы долго думали, как находить зрелищные моменты, и решили привлечь для помощи зрителей. Для этого перед презентацией сериала широкой аудитории мы просим разных людей посмотреть этот сериал и снимаем их эмоции на камеру. Так мы видим моменты, в которые зритель был наиболее впечатлён, и используем их при монтаже ролика.

Число сериалов, готовых к запуску, стремительно растёт, нам всё сложнее отсматривать эмоции зрителей в ручном режиме. Мы решили приспособить для этого нейронную сеть, поэтому обратились за помощью к вам. Ваши предсказания мы используем для автоматического составления трейлеров, а также для анализа фильмов и сериалов, чтобы в дальнейшем получить идеальный с точки зрения эмоций зрителя контент.

А если вы сильны не только в обучении моделей компьютерного зрения, то у нас дополнительная просьба. Создайте для наших асессоров скрипт, который будет работать с их веб-камерами и выводить на экран текущую эмоцию.

## Техническое задание на финальную работу

Финальная работа — это соревнование на платформе Kaggle. Ссылка.

Необходимо написать воспроизводимый код, генерирующий csv-файл с ответами. В нём для каждого изображения с лицом человека должна указываться наиболее вероятная эмоция из представленных. Пример такого файла — на платформе Kaggle (файл sample_submission.csv).

Вы можете отправить на валидацию не более пяти решений в день.

Обратите внимание, что на платформе Kaggle существует разбиение отправленного вами файла на public и private части. В задании 50% изображений теста соответствуют публичной части, остальные 50% — приватной. До окончания соревнования результат вашей модели известен только на public-части. Такое разбиение нужно, чтобы модели не переобучались на тесте.

Описание данных, формат файла для ответа и метрику качества вы найдёте в самом соревновании на Kaggle.

## Технические требования

Работа требует реализации алгоритма, с помощью которого будет происходить заданная классификация. Приветствуется использование архитектур свёрточных нейронных сетей, разобранных во время теоретических занятий. Время инференса сети на Google Colab не должно превышать 0,33 секунды (3 кадра в секунду).

## Улучшения и дополнения к заданию

Чтобы выполнить дополнительную просьбу заказчика, попробуйте использовать модель в небольшом прототипе: берите кадры из веб-камеры, прогоняйте их через модель, а в окне камеры выводите результат.

Для этого сделайте следующее:

1. Разберитесь с работой камеры на вашем ноутбуке через библиотеку opencv. Примеры работы камеры с opencv смотрите в дополнительных материалах к этому заданию.
2. Возьмите предобученный детектор лица. Используйте примеры из дополнительных материалов или обучите свой детектор.
3. Оберните вашу модель в Python-класс с методами:
   - `__init__`, в котором будет происходить загрузка весов вашей модели.
   - `predict`, который будет принимать на вход предобработанный кадр из веб-камеры и возвращать эмоцию.
4. Сделайте вывод камеры таким, как показано на рисунке ниже. Расположение и цвета элементов остаются на ваше усмотрение.

## Формат сдачи материалов и оценивание

Первым шагом добейтесь, чтобы посылка на Kaggle получила результат выше отметки «Зачёт» на лидерборде (0.29880). Решения будут оцениваться по метрике categorical_accuracy. Помимо этой посылки пришлите код разработанной рекомендательной системе в GitHub/GitLab. Код должен быть полностью запускаемый и покрытый комментариями. Обязательно укажите в README инструкции по запуску.

В коде оставьте все решения, которые тестировались при выполнении финальной работы. Так мы сможем оценить объём и количество проведённых экспериментов. Каждый такой эксперимент сопроводите комментариями с результатами теста и сделанными выводами.

Оценка «Зачёт» ставится, если метрика отправленного решения на public leaderboard > метрики «Зачёт» и решение воспроизводимо, то есть проверяющий может его запустить и добиться аналогичного качества метрики.

Для оценки «4» необходимо пройти планку «Зачёт» на private leaderboard, а также выполнить два пункта из раздела «Предложения по повышению оценки».

Для оценки «5» необходимо, чтобы результат на private leaderboard был > 0,4, а также нужно выполнить все пункты из раздела «Для повышения оценки».

## Для повышения оценки

1. Используйте подходы по искусственному увеличению датасета для обучения, а именно — аргументации, рассмотренные в курсе.
2. Используйте продвинутые техники обучения, такие как finetuning и другие, рассмотренные в курсе.
3. Пишите структурный код (основная логика кода должна быть вынесена в классы/методы/функции + осмысленный нейминг сущностей и комментарии).
4. Проведите эксперименты с valence-arousal разложением эмоций, когда модель обучается не на самих эмоциях, а на их разложении по этим двум компонентам. Информация о подобном разложении есть в дополнительных материалах.
5. Работающий прототип из пункта «Улучшение и дополнения к заданию» прибавляет один балл к итоговой оценке и добавляет в портфолио ценный ML-проект.

## Подсказки и советы

Пользоваться подсказками рекомендуется в сложных случаях, когда идеи иссякли, а решение нужного качества не получается. Открывайте подсказки по очереди, а не все сразу. То есть третья подсказка должна быть открыта в момент, когда две предыдущих подсказки не помогли сдать задание на нужный балл.

[Ссылка на подсказки](https://colab.research.google.com/drive/13UoATlI-iPd9Jg9fo-f3jcqWUNj6PJZ4?usp=sharing)

## Дополнительный теоретический материал

Подборка релевантных статей для вдохновения:

- Введение в задачу распознавания эмоций. Авторы описывают концепции решений в зависимости от входных данных.
- Бизнес-приложения задачи распознавания эмоций: [https://rb.ru/longread/emotion-ai/](https://rb.ru/longread/emotion-ai/).
- Продвинутое задание: туториал по работе с камерой в Python.